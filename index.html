<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>BBCSS Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{height:100%;margin:0;background:#0b0f1a;color:#e5e7eb;font-family:Arial,sans-serif;}

/* ================= LOGIN ================= */
#loginScreen{
  position:fixed;inset:0;
  background:radial-gradient(circle at top,#020617,#000);
  display:flex;align-items:center;justify-content:center;
  z-index:10000;
}
.login-box{
  width:360px;background:#0f172a;padding:28px;
  border-radius:10px;border:1px solid #1f2937;
  text-align:center;
}
.login-box img{width:140px;margin-bottom:16px;}
.login-box input{
  width:100%;padding:10px;margin-bottom:10px;
  background:#020617;border:1px solid #1f2937;color:#e5e7eb;
}
.login-box button{
  width:100%;padding:10px;
  background:#2563eb;border:none;color:#fff;
  font-weight:600;cursor:pointer;
}
#loginError{color:#ef4444;font-size:12px}

/* ================= HEADER ================= */
#header{
  position:relative;height:64px;background:#020617;
  border-bottom:1px solid #1f2937;
  display:none;z-index:1000;
}
#menuBtn{
  position:absolute;left:18px;top:50%;
  transform:translateY(-50%);
  background:none;border:none;color:#e5e7eb;
  font-size:22px;cursor:pointer;
}
#headerCenter{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  display:flex;align-items:center;gap:12px;
}
.logo{height:40px;}
.header-title{font-size:18px;font-weight:600;}

/* ================= MENU ================= */
#menuPanel{
  position:fixed;top:64px;left:-260px;
  width:240px;height:calc(100% - 64px);
  background:#020617;border-right:1px solid #1f2937;
  padding:14px;transition:left .25s ease;
  z-index:999;display:none;
}
#menuPanel.open{left:0;}
#menuPanel h3{margin:0 0 12px;font-size:13px;color:#9ca3af;}
#menuPanel button{
  width:100%;padding:8px;margin-bottom:8px;
  background:#020617;border:1px solid #1f2937;
  color:#e5e7eb;text-align:left;cursor:pointer;
}
#menuPanel button:hover{background:#2563eb;border-color:#2563eb;}

/* ================= LAYOUT ================= */
.page{display:none;}
.page.active{display:block;}
.container{display:flex;height:calc(100vh - 64px - 54px);}

/* ================= SIDEBAR ================= */
#sidebar{
  width:420px;background:#0f172a;
  border-right:1px solid #1f2937;
  padding:14px;overflow-y:auto;
}
.section{margin-bottom:14px;}
.section h3{
  font-size:13px;padding:6px 8px;background:#020617;
  border-left:4px solid #2563eb;margin:0 0 6px;
}
.section .content{
  background:#0b1220;padding:8px;
  border:1px solid #1f2937;font-size:13px;
}
.empty{color:#6b7280}

/* ================= TABLE ================= */
table{width:100%;border-collapse:collapse;font-size:12px;}
th,td{padding:5px;border:1px solid #1f2937;}
th{background:#020617;}
.on-duty{background:rgba(16,185,129,.15);}
.off-duty{background:rgba(245,158,11,.15);}
.absconding{background:rgba(239,68,68,.25);font-weight:bold;}

/* ================= MAP ================= */
#map{flex:1;}

/* ================= SUMMARY ================= */
#summaryPanel{
  position:fixed;bottom:0;left:0;right:0;height:54px;
  background:#020617;border-top:1px solid #1f2937;
  display:none;justify-content:space-around;align-items:center;
}
.summary-item{text-align:center;font-size:12px;}
.summary-item .label{color:#9ca3af;font-size:11px;}
.summary-item .value{font-size:16px;font-weight:bold;}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <img src="https://lh3.googleusercontent.com/d/12Xf4kpshWWpf-TntBM7dCTNyemEWPeUt">
    <h3>BBCSS Command Center</h3>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError"></p>
  </div>
</div>

<!-- MENU -->
<div id="menuPanel">
  <h3>MENU</h3>
  <button onclick="showPage('map')">üó∫Ô∏è Command Center</button>
  <button onclick="showPage('site')">üè¢ Site Details</button>
</div>

<!-- HEADER -->
<div id="header">
  <button id="menuBtn" onclick="toggleMenu()">‚ò∞</button>
  <div id="headerCenter">
    <img src="https://lh3.googleusercontent.com/d/12Xf4kpshWWpf-TntBM7dCTNyemEWPeUt" class="logo">
    <div class="header-title">BBCSS Command Center</div>
  </div>
</div>

<!-- MAP PAGE -->
<div id="page-map" class="page active">
  <div class="container">
    <div id="sidebar">
      <div class="section">
        <h3>Site Details</h3>
        <div id="sitePanel" class="content empty">Click a site pin</div>
      </div>
    </div>
    <div id="map"></div>
  </div>
</div>

<!-- SITE DETAILS PAGE -->
<div id="page-site" class="page">
  <h2 style="padding:20px">üè¢ Site Details (Coming Next)</h2>
</div>

<!-- SUMMARY -->
<div id="summaryPanel">
  <div class="summary-item"><div class="label">Sites</div><div id="sumSites" class="value">0</div></div>
  <div class="summary-item"><div class="label">Guards</div><div id="sumGuards" class="value">0</div></div>
</div>

<script>
/* ================= AUTH ================= */
const USERS=[{u:"admin",p:"bbcss123"},{u:"ops",p:"ops123"}];
function login(){
  if(!USERS.find(x=>x.u===username.value && x.p===password.value)){
    loginError.innerText="Invalid credentials";return;
  }
  sessionStorage.setItem("bbcss","1");
  loginScreen.style.display="none";
  header.style.display="block";
  menuPanel.style.display="block";
  summaryPanel.style.display="flex";
  initMap();
}
if(sessionStorage.getItem("bbcss")==="1"){
  loginScreen.style.display="none";
  header.style.display="block";
  menuPanel.style.display="block";
  summaryPanel.style.display="flex";
}

/* ================= MENU ================= */
function toggleMenu(){menuPanel.classList.toggle("open");}
function showPage(p){
  document.querySelectorAll(".page").forEach(pg=>pg.classList.remove("active"));
  document.getElementById("page-"+p).classList.add("active");
  menuPanel.classList.remove("open");
}

/* ================= DATA ================= */
const SHEET_ID="1sp0zxqkeBLyNLMcLgnmRRcwAm_AiXLI3XGSCvWvWnoM";
const SITES_URL=`https://opensheet.elk.sh/${SHEET_ID}/Sites`;
const GUARDS_URL=`https://opensheet.elk.sh/${SHEET_ID}/Guards`;

let map,sites=[],guards=[],markers=[];

/* ================= MAP ================= */
async function initMap(){
  map=new google.maps.Map(document.getElementById("map"),{
    center:{lat:17.5,lng:78.4},zoom:7
  });
  sites=await fetch(SITES_URL).then(r=>r.json());
  guards=await fetch(GUARDS_URL).then(r=>r.json());
  renderMarkers();
}

function renderMarkers(){
  markers.forEach(m=>m.setMap(null));markers=[];
  sites.forEach(site=>{
    const m=new google.maps.Marker({
      map,position:{lat:+site.Latitude,lng:+site.Longitude},title:site.Name
    });
    m.addListener("click",()=>showSite(site));
    markers.push(m);
  });
  sumSites.innerText=sites.length;
  sumGuards.innerText=guards.length;
}

function showSite(site){
  const list = guards.filter(g => g["Site Name"] === site.Name);

  const lat = site.Latitude;
  const lng = site.Longitude;

  sitePanel.innerHTML = `
    <b>${site.Name}</b><br><br>

    <button
      style="
        width:100%;
        padding:8px;
        margin-bottom:10px;
        background:#16a34a;
        border:none;
        color:#fff;
        cursor:pointer;
        font-weight:600;
      "
      onclick="openDirections(${lat}, ${lng})"
    >
      üìç Navigate (Google Maps)
    </button>

    ${guardsTable(list)}
  `;
}
  function openDirections(lat, lng){
  const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
  window.open(url, "_blank");
}


function guardsTable(list){
  if(!list.length) return "<div class='empty'>No guards</div>";
  return `<table>
    <tr><th>#</th><th>Name</th><th>ID</th><th>Rank</th><th>Status</th></tr>
    ${list.map((g,i)=>`
      <tr class="${g["Duty Status"]==="On Duty"?"on-duty":g["Duty Status"]==="Off Duty"?"off-duty":"absconding"}">
        <td>${i+1}</td>
        <td>${g["Guard Name"]}</td>
        <td>${g["Guard ID"]||""}</td>
        <td>${g.Rank||""}</td>
        <td>${g["Duty Status"]}</td>
      </tr>`).join("")}
  </table>`;
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyConhuaK9NwmTVHZ5yk7n54uuFTzqtG2wI"></script>
</body>
</html>


